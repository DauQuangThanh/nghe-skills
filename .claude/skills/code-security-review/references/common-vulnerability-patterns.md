# Common Vulnerability Patterns


### Authentication Bypass

**Pattern:**
```python
# Authentication can be bypassed by omitting header
if 'Authorization' in request.headers:
    verify_token(request.headers['Authorization'])
# Proceeds without authentication if header missing
```

**Fix:**
```python
if 'Authorization' not in request.headers:
    abort(401, "Authentication required")
verify_token(request.headers['Authorization'])
```

### Race Conditions

**Pattern:**
```python
# Time-of-check-time-of-use vulnerability
if user.balance >= amount:
    time.sleep(0.1)  # Window for race condition
    user.balance -= amount
```

**Fix:**
```python
# Atomic operation with database-level locking
with db.session.begin():
    user = User.query.with_for_update().get(user_id)
    if user.balance >= amount:
        user.balance -= amount
```

### Timing Attacks

**Pattern:**
```python
# Timing attack on token comparison
if user_token == valid_token:
    return True
```

**Fix:**
```python
import hmac
# Constant-time comparison
return hmac.compare_digest(user_token, valid_token)
```
